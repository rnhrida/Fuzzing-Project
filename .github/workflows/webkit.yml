name: WebKit Fuzzer Pipeline
on:
  push:
    branches: [main]
jobs:
  fuzz-webkit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install Tools
        run: sudo apt-get update -qq && sudo apt-get install -y clang libasan6
      - name: Build
        run: clang++ -fsanitize=fuzzer,address -g webkit/harness/html_fuzzer.cc -o webkit_fuzzer
      - name: Fuzz
        run: |
          mkdir -p webkit/output
          timeout 300 ./webkit_fuzzer webkit/seeds/ -max_total_time=300 2>&1 | tee webkit/output/run.log || true
      - name: Upload
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: webkit-results
          path: |
            webkit/output/
            crash-*